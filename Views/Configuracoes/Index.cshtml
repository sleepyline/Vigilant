@model VigiLant.Models.AppConfig
@using VigiLant.Models.Enum // Necessário para acessar o Enum MqttPorta

@{
    ViewData["Title"] = "Configurações do Sistema";
}

<link rel="stylesheet" href="/css/viewrevo.css" asp-append-version="true" />

<div class="page-header">
    <h1 class="page-title">⚙️ Configurações do Sistema</h1>
    <div class="breadcrumb">
        <a href="@Url.Action("Index", "Home")">Dashboard</a>
        <span class="separator">/</span>
        <span class="active">Configurações</span>
    </div>
</div>

<div class="card-container">
    <div class="card">
        <h4 class="card-title">Configurações MQTT Broker</h4>
        <p class="card-subtitle">Ajuste o host e o tópico para conectar a um broker MQTT diferente.</p>

        @if (ViewBag.SuccessMessage != null)
        {
            <div class="alert alert-success mt-3" role="alert">
                <i class="fas fa-check-circle"></i> @ViewBag.SuccessMessage
            </div>
        }

        <form asp-action="Index" method="post">
            @Html.AntiForgeryToken()
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            
            <input type="hidden" asp-for="Id" />

            <div class="form-group mb-3">
                <label asp-for="MqttHost" class="form-label"></label>
                <input asp-for="MqttHost" class="form-control" />
                <span asp-validation-for="MqttHost" class="text-danger"></span>
            </div>
            
            {{-- NOVO CAMPO: SELEÇÃO DA PORTA POR ENUM --}}
            <div class="form-group mb-3">
                <label asp-for="MqttPort" class="form-label"></label>
                {{-- Usando o Helper para gerar opções do Enum com base no DisplayName --}}
                <select asp-for="MqttPort" asp-items="Html.GetEnumSelectList<MqttPorta>()"
                    class="form-select"></select>
                <span asp-validation-for="MqttPort" class="text-danger"></span>
                <small class="form-text text-muted">A porta define o tipo de conexão: TCP padrão (1883) ou Segura/WebSocket (outras).</small>
            </div>
            {{-- FIM NOVO CAMPO --}}

            <div class="form-group mb-3">
                <label asp-for="MqttTopicWildcard" class="form-label"></label>
                <input asp-for="MqttTopicWildcard" class="form-control" />
                <span asp-validation-for="MqttTopicWildcard" class="text-danger"></span>
                <small class="form-text text-muted">Ex: <code>vigilant/data/#</code> (o `#` capta todos os sub-tópicos)</small>
            </div>

            <div class="form-group mt-4 text-end">
                <button type="submit" class="btn-primary">
                    <i class="fas fa-save"></i> Salvar Configurações
                </button>
            </div>
        </form>

    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}